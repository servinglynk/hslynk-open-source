/*! BootsFaces 2019-05-28 */
var app=angular.module("app",["ngRoute","ngStorage","ngAnimate","route-segment","view-segment","ui.bootstrap"]),header={sessionToken:""};app.directive("fileModel",["$parse",function(a){return{restrict:"A",link:function(b,c,d){var e=a(d.fileModel),f=e.assign;c.bind("change",function(){b.$apply(function(){f(b,c[0].files[0])})})}}}]),app.factory("LS",["$window","$rootScope",function(a,b){return angular.element(a).on("storage",function(a){"my-storage"===a.key&&b.$apply()}),{setData:function(b){return a.localStorage&&a.localStorage.setItem("my-storage",b),this},getData:function(){return a.localStorage&&a.localStorage.getItem("my-storage")}}}]),app.config(["$routeSegmentProvider","$routeProvider",function(a,b){a.options.autoLoadTemplates=!0,a.when("/login","s1").when("/login","s4").when("/admin","s2.dashboard").when("/admin/dashboard","s2.dashboard").when("/admin/managefiles","s2.managefiles").when("/admin/bulkupload","s2.bulkupload").when("/admin/bulkuploadNew","s2.bulkuploadNew").when("/admin/managesync","s2.managesync").when("/admin/managereport","s2.managereport").when("/admin/manageeligreq","s2.manageeligreq").when("/admin/setting","s2.setting").when("/admin/requestreport","s2.requestreport").when("/admin/createprojgrp","s2.createprojgrp").when("/admin/manageprojgrp","s2.manageprojgrp").when("/admin/createorg","s2.createorg").when("/admin/manageorg","s2.manageorg").when("/admin/createprofile","s2.createprofile").when("/admin/manageprofile","s2.manageprofile").when("/admin/createrole","s2.createrole").when("/admin/managerole","s2.managerole").when("/admin/createuser","s2.createuser").when("/admin/manageuser","s2.manageuser").when("/admin/onboardfellow","s2.onboardfellow").when("/admin/errormessage/:id","s2.errormessage").when("/admin/onboardfellowgroup","s2.onboardfellow.onboardfellowgroup").when("/admin/onboardfellowuser","s2.onboardfellow.onboardfellowuser").segment("s1",{templateUrl:"templates/login.html"}).segment("s4",{templateUrl:"templates/login.html",controller:"logoutCtrl"}).segment("s2",{templateUrl:"templates/root.html"}).within().segment("dashboard",{templateUrl:"templates/partial/dashboard.html",controller:"dashboardCtrl"}).segment("managefiles",{templateUrl:"templates/partial/managefiles.html",controller:"managefilesCtrl"}).segment("errormessage",{templateUrl:"templates/partial/errormessage.html",controller:"errormessageCtrl"}).segment("manageuser",{templateUrl:"templates/partial/manageuser.html",controller:"manageuserCtrl"}).segment("managereport",{templateUrl:"templates/partial/managereport.html",controller:"managereportCtrl"}).segment("manageeligreq",{templateUrl:"templates/partial/manageeligreq.html",controller:"manageeligreqCtrl"}).segment("bulkupload",{templateUrl:"templates/partial/bulkupload.html",controller:"bulkUploadCtrl"}).segment("bulkuploadNew",{templateUrl:"templates/partial/bulkuploadnew.html",controller:"bulkUploadNewCtrl"}).segment("managesync",{templateUrl:"templates/partial/managesync.html",controller:"managesyncCtrl"}).segment("setting",{templateUrl:"templates/partial/setting.html",controller:"settingCtrl"}).segment("requestreport",{templateUrl:"templates/partial/requestreport.html",controller:"requestreportCtrl"}).segment("createorg",{templateUrl:"templates/partial/createorg.html",controller:"createorgCtrl"}).segment("manageorg",{templateUrl:"templates/partial/manageorg.html",controller:"manageorgCtrl"}).segment("createprofile",{templateUrl:"templates/partial/createprofile.html",controller:"createprofileCtrl"}).segment("manageprofile",{templateUrl:"templates/partial/manageprofile.html",controller:"manageprofileCtrl"}).segment("createrole",{templateUrl:"templates/partial/createrole.html",controller:"createroleCtrl"}).segment("manageprofile",{templateUrl:"templates/partial/managerole.html",controller:"manageroleCtrl"}).segment("createprojgrp",{templateUrl:"templates/partial/createprojgrp.html",controller:"createprojgrpCtrl"}).segment("manageprojgrp",{templateUrl:"templates/partial/manageprojgrp.html",controller:"manageprojgrpCtrl"}).segment("createuser",{templateUrl:"templates/partial/createuser.html",controller:"createuserCtrl"}).segment("manageuser",{templateUrl:"templates/partial/manageuser.html",controller:"manageuserCtrl"}).segment("onboardfellow",{templateUrl:"templates/partial/onboardfellow.html",controller:"onboardfellowCtrl"}).within().segment("onboardfellowgroup",{templateUrl:"templates/partial/onboardfellowgroup.html",controller:"onboardfellowgroupCtrl"}).segment("onboardfellowuser",{templateUrl:"templates/partial/onboardfellowuser.html",controller:"onboardfellowuserCtrl"}).up(),b.otherwise({redirectTo:"/login"})}]),app.run(["$rootScope","$location","$sessionStorage","$http",function(a,b,c,d){void 0!=c.account&&void 0!=c.account.roles&&(a.roleName=c.account.roles[0].roleName),"/admin/dashboard"!=b.path()&&"/login"!=b.path()&&void 0==c.isLoggedIn&&b.path("/login")}]),app.value("loader",{show:!1}),app.directive("appFilereader",["$q",function(a){Array.prototype.slice;return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){d&&(d.$render=function(){},b.bind("change",function(a){var b=a.target;d.$setViewValue(b)}))}}}]);var filesCollection="",Service={GetProjectList:function(a,b,c,d){a({method:"GET",url:"/hmis-clientapi-v2017/rest/v2/projects",headers:{"X-HMIS-TrustedApp-Id":"MASTER_TRUSTED_APP",Authorization:"HMISUserAuth session_token="+d.sessionToken,Accept:"application/json;odata=verbose"}}).success(function(a){b&&b(a.projects.projects)}).error(c)},GetUserInfo:function(a,b,c,d){a({method:"GET",url:"/hmis-user-service/rest/accounts/self/basicinfo",headers:{"X-HMIS-TrustedApp-Id":"MASTER_TRUSTED_APP",Authorization:"HMISUserAuth session_token="+b.sessionToken,Accept:"application/json;odata=verbose"}}).success(function(a){c&&c(a)}).error(d)},GetUserByOrganization:function(a,b,c,d){b.organizationId="b5598c6c-d021-4f5f-9695-77f7f4685ed2",a({method:"GET",url:"/hmis-user-service/rest/accounts/"+b.organizationId+"/users",headers:{"X-HMIS-TrustedApp-Id":"MASTER_TRUSTED_APP",Authorization:"HMISUserAuth session_token="+b.sessionToken,Accept:"application/json;odata=verbose"}}).success(function(a){c&&c(a.accounts)}).error(d)},GetReports:function(a,b,c){a({method:"GET",url:"/hmis-report-service/rest/reports",headers:{"X-HMIS-TrustedApp-Id":"MASTER_TRUSTED_APP",Authorization:"HMISUserAuth session_token="+c.sessionToken,Accept:"application/json;odata=verbose"}}).success(function(a){b&&b(a.ReportConfigs.reportConfigs)})},GetFilesListRECENT:function(a,b,c){a({method:"GET",url:"/hmis-upload-service/rest/bulk-upload?status=RECENT",headers:{"X-HMIS-TrustedApp-Id":"MASTER_TRUSTED_APP",Authorization:"HMISUserAuth session_token="+c.sessionToken,Accept:"application/json;odata=verbose"}}).success(function(a){b&&b(a.BulkUploads.bulkUploads)})},GetFilesListSTAGING:function(a,b,c){a({method:"GET",url:"/hmis-upload-service/rest/bulk-upload?status=STAGING",headers:{"X-HMIS-TrustedApp-Id":"MASTER_TRUSTED_APP",Authorization:"HMISUserAuth session_token="+c.sessionToken,Accept:"application/json;odata=verbose"}}).success(function(a){b&&b(a.BulkUploads.bulkUploads)})},GetFilesListDELETED:function(a,b,c){a({method:"GET",url:"/hmis-upload-service/rest/bulk-upload?status=DELETED",headers:{"X-HMIS-TrustedApp-Id":"MASTER_TRUSTED_APP",Authorization:"HMISUserAuth session_token="+c.sessionToken,Accept:"application/json;odata=verbose"}}).success(function(a){b&&b(a.BulkUploads.bulkUploads)})},GetFilesListLIVE:function(a,b,c){a({method:"GET",url:"/hmis-upload-service/rest/bulk-upload?status=LIVE",headers:{"X-HMIS-TrustedApp-Id":"MASTER_TRUSTED_APP",Authorization:"HMISUserAuth session_token="+c.sessionToken,Accept:"application/json;odata=verbose"}}).success(function(a){b&&b(a.BulkUploads.bulkUploads)})},GetFilesListERROR:function(a,b,c){a({method:"GET",url:"/hmis-upload-service/rest/bulk-upload?status=ERROR",headers:{"X-HMIS-TrustedApp-Id":"MASTER_TRUSTED_APP",Authorization:"HMISUserAuth session_token="+c.sessionToken,Accept:"application/json;odata=verbose"}}).success(function(a){b&&b(a.BulkUploads.bulkUploads)})},GetFilesLogList:function(a,b,c){a({method:"GET",url:"/hmis-clientapi-v"+c.year+"/rest/bulkupload/activities/"+c.idForLog,headers:{"X-HMIS-TrustedApp-Id":"MASTER_TRUSTED_APP",Authorization:"HMISUserAuth session_token="+c.sessionToken,Accept:"application/json;odata=verbose"}}).success(function(a){b&&b(a)})},GetErrorMessage:function(a,b,c){a({method:"GET",url:"/hmis-clientapi-v"+c.year+"/rest/bulkupload/errors/"+c.id,headers:{"X-HMIS-TrustedApp-Id":"MASTER_TRUSTED_APP",Authorization:"HMISUserAuth session_token="+c.sessionToken,Accept:"application/json;odata=verbose"}}).success(function(a){b&&b(a.bulkUploadErrors.bulkUploadErrors)})},GetSyncFilesList:function(a,b){a.get("/hmis-bulk-loader-v2014/sync").success(function(a){b&&b(a)})},CheckServiceAvailableBulkUpload:function(a,b,c,d){a({method:"GET",url:"/hmis-upload-service/rest/bulk-upload?status=STAGING",headers:{"X-HMIS-TrustedApp-Id":"MASTER_TRUSTED_APP",Authorization:"HMISUserAuth session_token="+b.sessionToken,Accept:"application/json;odata=verbose"}}).success(function(a){c&&c(a.BulkUploads.bulkUploads)}).error(d)},CheckServiceAvailableUploadFile:function(a,b,c,d){a.post("/hmis-upload-service/uploadFile",{headers:{"X-HMIS-TrustedApp-Id":"MASTER_TRUSTED_APP",Authorization:"HMISUserAuth session_token="+b.sessionToken,Accept:"application/json;odata=verbose"}}).success(function(a){c&&c(a)}).error(d)},CheckServiceAvailableAuthenticate:function(a,b,c,d){a.post("/hmis-client-dedup/rest/api/v1/authenticate",{headers:{"X-HMIS-TrustedApp-Id":"MASTER_TRUSTED_APP",Authorization:"HMISUserAuth session_token="+b.sessionToken,Accept:"application/json;odata=verbose"}}).success(function(a){c&&c(a)}).error(d)},LoadStatistics:function(a,b,c){a.get("/hmis-upload-service/rest/bulk-upload?status=LIVE",{headers:{"X-HMIS-TrustedApp-Id":"MASTER_TRUSTED_APP",Authorization:"HMISUserAuth session_token="+b.sessionToken,Accept:"application/json;odata=verbose"}}).success(function(d){filesCollection=d.BulkUploads.bulkUploads,a.get("/hmis-upload-service/rest/bulk-upload?status=STAGING",{headers:{"X-HMIS-TrustedApp-Id":"MASTER_TRUSTED_APP",Authorization:"HMISUserAuth session_token="+b.sessionToken,Accept:"application/json;odata=verbose"}}).success(function(d){Array.prototype.push.apply(filesCollection,d.BulkUploads.bulkUploads),a.get("/hmis-upload-service/rest/bulk-upload?status=ERROR",{headers:{"X-HMIS-TrustedApp-Id":"MASTER_TRUSTED_APP",Authorization:"HMISUserAuth session_token="+b.sessionToken,Accept:"application/json;odata=verbose"}}).success(function(a){Array.prototype.push.apply(filesCollection,a.BulkUploads.bulkUploads),c(filesCollection)})})})},logout:function(a,b,c,d){a({method:"DELETE",url:"/hmis-user-service/rest/sessions/"+b.sessionToken,headers:{"X-HMIS-TrustedApp-Id":"MASTER_TRUSTED_APP",Authorization:"HMISUserAuth session_token="+b.sessionToken,Accept:"application/json;odata=verbose"}}).success(function(a){c&&c(a)})},SaveSetting:function(a,b,c,d){a({method:"POST",url:"/hmis-user-service/rest/accounts",data:{account:{username:b.emailAddress,emailAddress:b.emailAddress,password:b.password,firstName:b.firstName,lastName:b.lastName,accountId:b.accountId}},headers:{"X-HMIS-TrustedApp-Id":"MASTER_TRUSTED_APP",Authorization:"HMISUserAuth session_token="+b.sessionToken,Accept:"application/json;odata=verbose"}}).success(function(a){c&&c(a)}).error(d)},submitHivePasswordForm:function(a,b,c,d){a({method:"POST",url:"/hmis-user-service/rest/accounts",data:{account:{username:b.emailAddress,emailAddress:b.emailAddress,password:b.password,firstName:b.firstName,lastName:b.lastName,accountId:b.accountId}},headers:{"X-HMIS-TrustedApp-Id":"MASTER_TRUSTED_APP",Authorization:"HMISUserAuth session_token="+b.sessionToken,Accept:"application/json;odata=verbose"}}).success(function(a){c&&c(a)}).error(d)},SendRequestReport:function(a,b,c,d){data=b.form,data=b.form,a({method:"POST",url:"/hmis-report-service/rest/reports",data:{reportConfig:{name:data.name,startDate:data.startDate,endDate:data.endDate,reportType:data.reportType,reportLevel:data.reportLevel,projectIds:data.project}},headers:{"X-HMIS-TrustedApp-Id":"MASTER_TRUSTED_APP",Authorization:"HMISUserAuth session_token="+b.sessionToken,Accept:"application/json;odata=verbose"}}).success(function(a){c&&c(a)}).error(d)},bulkupload:function(a,b,c,d,e){var f=new FormData;f.append("version",b.form.version),f.append("fileName",b.fileName),f.append("bucketName",b.bucketName),a.post("/hmis-upload-service/rest/upload",f,{transformRequest:angular.identity,headers:{"X-HMIS-TrustedApp-Id":"MASTER_TRUSTED_APP",Authorization:"HMISUserAuth session_token="+b.sessionToken,"Content-Type":void 0}}).success(function(){d()}).error(e)},bulkuploadNew:function(a,b,c,d,e,f){var g="/hmis-upload-service/rest/bulk-upload/"+b.form.version,h=new FormData;h.append("file",c),a.post(g,h,{transformRequest:angular.identity,headers:{"X-HMIS-TrustedApp-Id":"MASTER_TRUSTED_APP",Authorization:"HMISUserAuth session_token="+b.sessionToken,"Content-Type":void 0}}).success(function(){e()}).error(f)},GetRoles:function(a,b,c){a({method:"GET",url:"/hmis-user-service/rest/roles?maxItems=10",headers:{"X-HMIS-TrustedApp-Id":"MASTER_TRUSTED_APP",Authorization:"HMISUserAuth session_token="+b.sessionToken,Accept:"application/json;odata=verbose"}}).success(function(a){c&&c(a)})},GetProfiles:function(a,b,c){a.get("/hmis-user-service/rest/profiles?maxItems=10",{headers:{"X-HMIS-TrustedApp-Id":"MASTER_TRUSTED_APP",Authorization:"HMISUserAuth session_token="+b.sessionToken,Accept:"application/json;odata=verbose"}}).success(function(a){c&&c(a)})},GetProjectGroups:function(a,b,c){a({method:"GET",cache:!1,url:"/hmis-user-service/rest/projectgroups?maxItems=100",headers:{"X-HMIS-TrustedApp-Id":"MASTER_TRUSTED_APP",Authorization:"HMISUserAuth session_token="+b.sessionToken,Accept:"application/json;odata=verbose"}}).success(function(a){c&&c(a)})},GetEligReq:function(a,b,c){a({method:"GET",data:"",cache:!1,url:"/inventory-api/rest/projects/eligibilityrequirements?page=0&size=100",headers:{"X-HMIS-TrustedApp-Id":"MASTER_TRUSTED_APP",Authorization:"HMISUserAuth session_token="+b.sessionToken,Accept:"application/json;odata=verbose","Content-Type":"application/json"}}).success(function(a){c&&c(a)})},createUser:function(a,b,c,d){data=b.form,a({method:"POST",url:"/hmis-user-service/rest/accounts",data:{account:{username:data.username,emailAddress:data.emailAddress,password:data.password,confirmPassword:data.confirmPassword,firstName:data.firstName,middleName:data.middleName,lastName:data.lastName,role:{id:data.role.id},projectGroup:{projectGroupId:data.projectgroup.projectGroupId},profile:{id:data.profile.id}}},headers:{"X-HMIS-TrustedApp-Id":"MASTER_TRUSTED_APP",Authorization:"HMISUserAuth session_token="+b.sessionToken,Accept:"application/json;odata=verbose"}}).success(function(a){c&&c(a)}).error(d)},createRole:function(a,b,c,d){data=b.form,a({method:"POST",url:"/hmis-user-service/rest/roles",data:{role:{roleName:data.name,roleDescription:data.desc}},headers:{"X-HMIS-TrustedApp-Id":"MASTER_TRUSTED_APP",Authorization:"HMISUserAuth session_token="+b.sessionToken,Accept:"application/json;odata=verbose"}}).success(function(a){c&&c(a)}).error(d)},createProjectGroup:function(a,b,c,d){console.warn(b,2),data=b.form,a({method:"POST",url:"/hmis-user-service/rest/projectgroups",data:{projectGroup:{projectGroupName:data.name,projectGroupDesc:data.desc,skipuseridentifers:data.skipuseridentifers}},headers:{"X-HMIS-TrustedApp-Id":"MASTER_TRUSTED_APP",Authorization:"HMISUserAuth session_token="+b.sessionToken,Accept:"application/json;odata=verbose"}}).success(function(a){c&&c(a)}).error(d)},getToken:function(a,b,c,d){a({method:"POST",url:"/hmis-authorization-service/rest/token?grant_type=authorization_code&code="+b.authToken+"&redirect_uri=http://ec2-52-38-189-237.us-west-2.compute.amazonaws.com:8080/hmis-admin/#/admin/dashboard",headers:{"X-HMIS-TrustedApp-Id":"MASTER_TRUSTED_APP",authorization:"Basic:TUFTVEVSX1RSVVNURURfQVBQOkhNSVM=",Accept:"application/json;odata=verbose"}}).success(function(a){c&&c(a)}).error(d)},_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=_utf8_encode(a);j<a.length;)b=a.charCodeAt(j++),c=a.charCodeAt(j++),d=a.charCodeAt(j++),e=b>>2,f=(3&b)<<4|c>>4,g=(15&c)<<2|d>>6,h=63&d,isNaN(c)?g=h=64:isNaN(d)&&(h=64),i=i+this._keyStr.charAt(e)+this._keyStr.charAt(f)+this._keyStr.charAt(g)+this._keyStr.charAt(h);return i},decode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");j<a.length;)e=this._keyStr.indexOf(a.charAt(j++)),f=this._keyStr.indexOf(a.charAt(j++)),g=this._keyStr.indexOf(a.charAt(j++)),h=this._keyStr.indexOf(a.charAt(j++)),b=e<<2|f>>4,c=(15&f)<<4|g>>2,d=(3&g)<<6|h,i+=String.fromCharCode(b),64!=g&&(i+=String.fromCharCode(c)),64!=h&&(i+=String.fromCharCode(d));return i=_utf8_decode(i)},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);d<128?b+=String.fromCharCode(d):d>127&&d<2048?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b}};app.controller("bulkUploadCtrl",["$scope","$location","$routeSegment","$http","$timeout","$sessionStorage",function(a,b,c,d,e,f){a.sessionToken=f.sessionToken,f.isLoggedIn&&$("#userDetails").html(f.account.emailAddress);var g={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b,c,d,e,f,h,i,j="",k=0;for(a=g._utf8_encode(a);k<a.length;)b=a.charCodeAt(k++),c=a.charCodeAt(k++),d=a.charCodeAt(k++),e=b>>2,f=(3&b)<<4|c>>4,h=(15&c)<<2|d>>6,i=63&d,isNaN(c)?h=i=64:isNaN(d)&&(i=64),j=j+this._keyStr.charAt(e)+this._keyStr.charAt(f)+this._keyStr.charAt(h)+this._keyStr.charAt(i);return j},decode:function(a){var b,c,d,e,f,h,i,j="",k=0;for(a=a.replace(/[^A-Za-z0-9+\/=]/g,"");k<a.length;)e=this._keyStr.indexOf(a.charAt(k++)),f=this._keyStr.indexOf(a.charAt(k++)),h=this._keyStr.indexOf(a.charAt(k++)),i=this._keyStr.indexOf(a.charAt(k++)),b=e<<2|f>>4,c=(15&f)<<4|h>>2,d=(3&h)<<6|i,j+=String.fromCharCode(b),64!=h&&(j+=String.fromCharCode(c)),64!=i&&(j+=String.fromCharCode(d));return j=g._utf8_decode(j)},_utf8_encode:function(a){a=a.replace(/rn/g,"n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);d<128?b+=String.fromCharCode(d):d>127&&d<2048?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b},_utf8_decode:function(a){for(var b="",c=0,d=c1=c2=0;c<a.length;)d=a.charCodeAt(c),d<128?(b+=String.fromCharCode(d),c++):d>191&&d<224?(c2=a.charCodeAt(c+1),b+=String.fromCharCode((31&d)<<6|63&c2),c+=2):(c2=a.charCodeAt(c+1),c3=a.charCodeAt(c+2),b+=String.fromCharCode((15&d)<<12|(63&c2)<<6|63&c3),c+=3);return b}};d.get("./config.json").then(function(a){var b=a.data;AWS.config.update({accessKeyId:g.decode(b.aKey),secretAccessKey:g.decode(b.sKey),region:g.decode(b.reg)})}),a.submitForm=function(c){a.projectGroupCode=f.account.projectGroup.projectGroupCode,a.infoTextAlert="Please wait uploading....",a.showInfoAlert=!0,a.showSuccessAlert=!1,a.showErrorAlert=!1;var e=new AWS.S3({params:{Bucket:f.account.projectGroup.bucketName.toLocaleLowerCase(),Prefix:"testfolder"}}),g=$("input[type='file'")[0],h=g.files[0];if(h){var i={Key:h.name,ContentType:h.type,Body:h,xhrFields:{withCredentials:!0}};e.upload(i).on("httpUploadProgress",function(a){console.log("Uploaded :: "+parseInt(100*a.loaded/a.total)+"%"),$(".bg-info").html("Please wait uploading.... "+parseInt(100*a.loaded/a.total)+"%")}).send(function(e,f){if(e)return a.successTextAlert="There was an error uploading your Hmis upload:"+e.message,!1;a.fileName=h.name,a.bucketName="sdolia-2015",Service.bulkupload(d,a,c,function(){a.switchBool("showInfoAlert"),a.successTextAlert="File has been uploaded successfully.",a.showInfoAlert=!1,a.showSuccessAlert=!0,b.path("/admin/managefiles")},function(){b.path("/admin/managefiles"),a.switchBool("showInfoAlert"),a.errorTextAlert="Error, Something gone wrong.",a.showInfoAlert=!1,a.showErrorAlert=!0})})}return!1},a.switchBool=function(b){a[b]=!a[b]}}]),app.controller("bulkUploadNewCtrl",["$scope","$location","$routeSegment","$http","$timeout","$sessionStorage",function(a,b,c,d,e,f){a.sessionToken=f.sessionToken,f.isLoggedIn&&$("#userDetails").html(f.account.emailAddress),a.submitForm=function(){a.infoTextAlert="Please wait uploading....",a.showInfoAlert=!0;var c=a.form.inputfile;Service.bulkuploadNew(d,a,c,function(b){console.log("percent: "+parseInt(100*b.loaded/b.total)),a.infoTextAlert=parseInt(100*b.loaded/b.total)},function(){a.switchBool("showInfoAlert"),a.successTextAlert="File has been uploaded successfully.",a.showSuccessAlert=!0,b.path("/admin/managefiles")},function(){a.switchBool("showInfoAlert"),a.errorTextAlert="Error, Something gone wrong.",a.showErrorAlert=!0})},a.switchBool=function(b){a[b]=!a[b]}}]),app.controller("createorgCtrl",["$scope","$location","$routeSegment","$http","$timeout","$sessionStorage",function(a,b,c,d,e,f){f.isLoggedIn&&$("#userDetails").html(f.account.emailAddress),Service.GetProjectList(d,function(b){a.projects=b}),a.submitForm=function(){Service.SendRequestReport(d,a,function(b){a.successTextAlert="Your Requset has been sent successfully.",a.showSuccessAlert=!0,a.form.email="",a.form.report="",a.form.year="",a.form.project=""},function(){a.errorTextAlert="Error, Something gone wrong.",a.showErrorAlert=!0})},a.switchBool=function(b){a[b]=!a[b]}}]),app.controller("createprojgrpCtrl",["$scope","$location","$routeSegment","$http","$timeout","$sessionStorage",function(a,b,c,d,e,f){a.sessionToken=f.sessionToken,f.isLoggedIn&&$("#userDetails").html(f.account.emailAddress),Service.GetProjectList(d,function(b){a.projects=b}),a.submitForm=function(){Service.createProjectGroup(d,a,function(b){a.successTextAlert="Your Requset has been sent successfully.",a.showSuccessAlert=!0,a.form.name="",a.form.desc=""},function(){a.errorTextAlert="Error, Something gone wrong.",a.showErrorAlert=!0})},a.switchBool=function(b){a[b]=!a[b]}}]),app.controller("createprojgrpCtrl",["$scope","$location","$routeSegment","$http","$timeout","$sessionStorage",function(a,b,c,d,e,f){a.sessionToken=f.sessionToken,f.isLoggedIn&&$("#userDetails").html(f.account.emailAddress),Service.GetProjectList(d,function(b){a.projects=b}),a.submitForm=function(){Service.createProjectGroup(d,a,function(b){a.successTextAlert="Your Requset has been sent successfully.",a.showSuccessAlert=!0,a.form.name="",a.form.desc=""},function(){a.errorTextAlert="Error, Something gone wrong.",a.showErrorAlert=!0})},a.switchBool=function(b){a[b]=!a[b]}}]),app.controller("createuserCtrl",["$scope","$location","$routeSegment","$http","$timeout","$sessionStorage",function(a,b,c,d,e,f){a.sessionToken=f.sessionToken,f.isLoggedIn&&$("#userDetails").html(f.account.emailAddress),Service.GetProfiles(d,a,function(b){a.profiles=b.profiles.profile}),Service.GetRoles(d,a,function(b){a.roles=b.roles.role}),Service.GetProjectGroups(d,a,function(b){a.projectgroups=b.projectgroups.projectGroups}),a.submitForm=function(){a.errorTextAlert="",a.showErrorAlert=!1,Service.createUser(d,a,function(b){a.successTextAlert="Your Requset has been sent successfully.",a.showSuccessAlert=!0,a.form.firstName="",a.form.lastName="",a.form.username="",a.form.password="",a.form.emailAddress=""},function(b){a.errorTextAlert=b.errors.error[0].message,a.showErrorAlert=!0})},a.switchBool=function(b){a[b]=!a[b]}}]),app.controller("dashboardCtrl",["$rootScope","$scope","$location","$routeSegment","$http","$timeout","$sessionStorage",function(a,b,c,d,e,f,g){b.authToken=c.search().code,"SUPERADMIN"==a.roleName?$(".dashboard").show():$(".dashboard").hide();var h=function(){Service.CheckServiceAvailableBulkUpload(e,b,function(a){$("#divBulkUpload .button-success").css("display","inline")},function(){$("#divBulkUpload .button-error").css("display","inline")}),Service.CheckServiceAvailableUploadFile(e,b,function(a){$("#divUploadFile .button-success").css("display","inline")},function(){$("#divUploadFile .button-success").css("display","inline")}),Service.CheckServiceAvailableAuthenticate(e,b,function(a){$("#divAuthenticate .button-success").css("display","inline")},function(){$("#divAuthenticate .button-success").css("display","inline")}),Service.LoadStatistics(e,b,function(a){b.managefiles=a})};g.authToken=b.authToken,g.sessionToken?(b.sessionToken=g.sessionToken,h()):(Service.getToken(e,b,function(d){g.sessionToken=d.oAuthAuthorization.accessToken,g.expiresIn=d.oAuthAuthorization.expiresIn,g.tokenType=d.oAuthAuthorization.tokenType,g.isLoggedIn=!0,b.sessionToken=d.oAuthAuthorization.accessToken,b.expiresIn=d.oAuthAuthorization.expiresIn,b.tokenType=d.oAuthAuthorization.tokenType,h(),Service.GetUserInfo(e,b,function(b){g.account=b.account,$("#userDetails").html(b.account.emailAddress),a.roleName=g.account.roles.role[0].roleName,g.roleName=g.account.roles.role[0].roleName,"SUPERADMIN"==a.roleName?$(".dashboard").show():$(".dashboard").hide()},function(){g.isLoggedIn?$("#userDetails").html(g.account.emailAddress):c.path("/login")}),"SUPERADMIN"==a.roleName?$(".dashboard").show():$(".dashboard").hide()},function(){g.isLoggedIn?$("#userDetails").html(g.account.emailAddress):c.path("/login")}),"SUPERADMIN"==a.roleName?$(".dashboard").show():$(".dashboard").hide())}]),app.controller("errormessageCtrl",["$scope","$location","$routeParams","$routeSegment","$http","$timeout","$sessionStorage",function(a,b,c,d,e,f,g){g.isLoggedIn&&$("#userDetails").html(g.account.emailAddress),a.sessionToken=g.sessionToken;var h=c.id,i=h.split("-");a.id=i[0],a.year=i[1],Service.GetErrorMessage(e,function(b){a.listErrorMessage=b,a.currentPageErrorMessage=1,a.entryLimitErrorMessage=10,a.filteredItemsErrorMessage=a.listErrorMessage.length,a.totalItemsErrorMessage=a.listErrorMessage.length},a),a.setPageErrorMessage=function(b){a.currentPageErrorMessage=b}}]),app.controller("validateLoginCtrl",["$scope","$location","$routeSegment",function(a,b,c){a.SubmitLogin=function(){"admin@servinglynk.com"==a.email&&"admin"==a.password?b.path(c.getSegmentUrl("s2.dashboard")):alert("Invalid username & password")}}]),app.controller("logoutCtrl",["$scope","$location","$routeSegment","$http","$timeout","$sessionStorage",function(a,b,c,d,e,f){f.isLoggedIn&&$("#userDetails").html(f.account.emailAddress),a.sessionToken=f.sessionToken,delete f.sessionToken,delete f.sessionToken,delete f.expiresIn,delete f.tokenType,delete f.authToken,delete f.isLoggedIn,delete f.account,Service.logout(d,a,function(){},function(){}),a.switchBool=function(b){a[b]=!a[b]}}]),app.controller("manageeligreqCtrl",["$scope","$location","$routeSegment","$http","$timeout","$modal","$sessionStorage",function(a,b,c,d,e,f,g){g.isLoggedIn&&$("#userDetails").html(g.account.emailAddress),a.sessionToken=g.sessionToken,Service.GetEligReq(d,a,function(b){a.list=b.content,a.currentPage=1,a.entryLimit=10,a.filteredItems=a.list.length,a.totalItems=a.list.length},function(a){}),a.setPage=function(b){a.currentPage=b},a.viewRequirements=function(a){f.open({templateUrl:"templates/partial/vieweligreq.html",controller:"viewEligReqCtrl",resolve:{datajson:function(){return a.requirements}}})}}]),app.controller("viewEligReqCtrl",["$scope","$location","$routeSegment","$http","$timeout","datajson",function(a,b,c,d,e,f){a.datajson=f}]),app.filter("startFrom",function(){return function(a,b){return a?(b=+b,a.slice(b)):[]}}),app.controller("ModalInstanceLogCtrl",["$scope","$location","$routeSegment","$http","$timeout","datajson",function(a,b,c,d,e,f){a.datajson=f}]),app.controller("managefilesCtrl",["$scope","$location","$routeSegment","$http","$timeout","$modal","$sessionStorage",function(a,b,c,d,e,f,g){g.isLoggedIn&&$("#userDetails").html(g.account.emailAddress),a.sessionToken=g.sessionToken,Service.GetFilesListRECENT(d,function(b){a.listRECENT=b,a.currentPageRECENT=1,a.entryLimitRECENT=10,a.filteredItemsRECENT=a.listRECENT.length,a.totalItemsRECENT=a.listRECENT.length},a),a.setPageRECENT=function(b){a.currentPageRECENT=b},Service.GetFilesListSTAGING(d,function(b){a.listSTAGING=b,a.currentPageSTAGING=1,a.entryLimitSTAGING=10,a.filteredItemsSTAGING=a.listSTAGING.length,a.totalItemsSTAGING=a.listSTAGING.length},a),a.setPageSTAGING=function(b){a.currentPageSTAGING=b},Service.GetFilesListLIVE(d,function(b){a.listLIVE=b,a.currentPageLIVE=1,a.entryLimitLIVE=10,a.filteredItemsLIVE=a.listLIVE.length,a.totalItemsLIVE=a.listLIVE.length},a),a.setPageLIVE=function(b){a.currentPageLIVE=b},Service.GetFilesListERROR(d,function(b){a.listERROR=b,a.currentPageERROR=1,a.entryLimitERROR=10,a.filteredItemsERROR=a.listERROR.length,a.totalItemsERROR=a.listERROR.length},a),a.setPageERROR=function(b){a.currentPageERROR=b},Service.GetFilesListDELETED(d,function(b){a.listDELETED=b,a.currentPageDELETED=1,a.entryLimitDELETED=10,a.filteredItemsDELETED=a.listDELETED.length,a.totalItemsDELETED=a.listDELETED.length},a),a.setPageDELETED=function(b){a.currentPageDELETED=b},a.openlog=function(b,c){a.idForLog=b,a.year=c,Service.GetFilesLogList(d,function(a){f.open({templateUrl:"templates/partial/syncfilelogpopopup.html",controller:"ModalInstanceLogCtrl",resolve:{datajson:function(){return a.bulkUploadActivities.bulkUploadActivities}}})},a)}}]),app.controller("manageprojgrpCtrl",["$scope","$location","$routeSegment","$http","$timeout","$sessionStorage",function(a,b,c,d,e,f){f.isLoggedIn&&$("#userDetails").html(f.account.emailAddress),a.sessionToken=f.sessionToken,Service.GetProjectGroups(d,a,function(b){a.list=b.projectgroups.projectGroups,a.currentPage=1,a.entryLimit=10,a.filteredItems=a.list.length,a.totalItems=a.list.length},function(a){}),a.setPage=function(b){a.currentPage=b}}]),app.controller("managereportCtrl",["$scope","$location","$routeSegment","$http","$modal","$timeout","$sessionStorage",function(a,b,c,d,e,f,g){g.isLoggedIn&&$("#userDetails").html(g.account.emailAddress),a.sessionToken=g.sessionToken,Service.GetReports(d,function(b){a.list=b,a.currentPage=1,a.entryLimit=10,a.filteredItems=a.list.length,a.totalItems=a.list.length},a),a.setPage=function(b){a.currentPage=b},a.openlog=function(b){a.projectIds=b,console.log("Projects"+b);e.open({templateUrl:"templates/partial/reportprojectspopopup.html",controller:"ModalInstanceLogCtrl",resolve:{datajson:function(){return b}}})}}]),app.controller("ModalInstanceLogCtrl",["$scope","$location","$routeSegment","$http","$timeout","datajson",function(a,b,c,d,e,f){a.datajson=f}]),app.controller("ModalInstanceCtrl",["$scope","$location","$routeSegment","$http","$timeout","datajson",function(a,b,c,d,e,f){a.datajson=f}]),app.controller("managesyncCtrl",["$scope","$location","$routeSegment","$http","$timeout","$modal","$sessionStorage",function(a,b,c,d,e,f,g){g.isLoggedIn&&$("#userDetails").html(g.account.emailAddress),Service.GetSyncFilesList(d,function(b){a.listSTAGING=b,a.currentPageSTAGING=1,a.entryLimitSTAGING=10,a.filteredItemsSTAGING=a.listSTAGING.length,a.totalItemsSTAGING=a.listSTAGING.length}),a.setPageSTAGING=function(b){a.currentPageSTAGING=b},a.openModel=function(a){f.open({templateUrl:"templates/partial/syncpopopup.html",controller:"ModalInstanceCtrl",resolve:{datajson:function(){return a.json.replace("}","").replace("{","").split(",")}}})}}]),app.controller("manageuserCtrl",["$scope","$location","$routeSegment","$http","$timeout","$sessionStorage",function(a,b,c,d,e,f){a.sessionToken=f.sessionToken,f.isLoggedIn&&$("#userDetails").html(f.account.emailAddress),Service.GetUserByOrganization(d,a,function(b){a.list=b.account,a.currentPage=1,a.entryLimit=10,a.filteredItems=a.list.length,a.totalItems=a.list.length},function(a){}),a.setPage=function(b){a.currentPage=b}}]),app.controller("onboardfellowCtrl",["$scope","$location","$routeSegment","$http","$timeout","$sessionStorage",function(a,b,c,d,e,f){f.isLoggedIn&&$("#userDetails").html(f.account.emailAddress),a.sessionToken=f.sessionToken}]),app.controller("onboardfellowgroupCtrl",["$scope","$location","$routeSegment","$http","$timeout","$sessionStorage",function(a,b,c,d,e,f){$("#createUser").removeClass("active"),$("#createGroup").addClass("active"),a.sessionToken=f.sessionToken,a.submitForm=function(){Service.createProjectGroup(d,a,function(c){a.successTextAlert="Your Requset has been sent successfully.",a.showSuccessAlert=!0,a.form.name="",a.form.desc="",b.path("/admin/onboardfellowuser")},function(){a.errorTextAlert="Error, Something gone wrong.",a.showErrorAlert=!0})},a.switchBool=function(b){a[b]=!a[b]}}]),app.controller("onboardfellowuserCtrl",["$rootScope","$scope","$location","$routeSegment","$http","$timeout","$sessionStorage",function(a,b,c,d,e,f,g){$("#createGroup").removeClass("active"),$("#createUser").addClass("active"),b.sessionToken=g.sessionToken,Service.GetProfiles(e,b,function(a){b.profiles=a.profiles.profile}),Service.GetRoles(e,b,function(c){for(var d=[],e=0;e<c.roles.role.length;e++)"SUPERADMIN"!=a.roleName&&"SUPERADMIN"==c.roles.role[e].roleName||d.push(c.roles.role[e]);b.roles=d}),Service.GetProjectGroups(e,b,function(a){b.projectgroups=a.projectgroups.projectGroups}),b.prev=function(){c.path("/admin/onboardfellowgroup")},b.submitForm=function(){b.errorTextAlert="",b.showErrorAlert=!1,Service.createUser(e,b,function(a){b.successTextAlert="Your Requset has been sent successfully.",b.showSuccessAlert=!0,b.form.firstName="",b.form.lastName="",b.form.username="",b.form.password="",b.form.emailAddress="",b.form.gender="",c.path("/admin/manageuser")},function(a){b.errorTextAlert=a.errors.error[0].message,b.showErrorAlert=!0})},b.switchBool=function(a){b[a]=!b[a]}}]),app.controller("requestreportCtrl",["$scope","$location","$routeSegment","$http","$timeout","$sessionStorage",function(a,b,c,d,e,f){f.isLoggedIn&&$("#userDetails").html(f.account.emailAddress),a.sessionToken=f.sessionToken,Service.GetProjectList(d,function(b){a.projects=b},function(){a.errorTextAlert="Error, Something gone wrong with getting projects.",a.showErrorAlert=!0},a),a.submitForm=function(){Service.SendRequestReport(d,a,function(b){a.successTextAlert="Your Requset has been sent successfully.",a.showSuccessAlert=!0,a.form.name="",a.form.reportLevel="",a.form.reportType="",a.form.startDate="",a.form.endDate="",a.form.project=[]},function(){a.errorTextAlert="Error, Something gone wrong.",a.showErrorAlert=!0})},a.switchBool=function(b){a[b]=!a[b]}}]),app.controller("settingCtrl",["$scope","$location","$routeSegment","$http","$timeout","$sessionStorage",function(a,b,c,d,e,f){f.isLoggedIn&&(a.sessionToken=f.sessionToken,$("#userDetails").html(f.account.emailAddress),a.emailAddress=f.account.emailAddress,a.username=f.account.emailAddress,a.role=f.account.roles.role[0].roleName,a.firstName=f.account.firstName,a.lastName=f.account.lastName,a.accountId=f.account.accountId),a.submitForm=function(){test=a,Service.SaveSetting(d,a,function(b){a.successTextAlert="Setting has been updated successfully.",a.showSuccessAlert=!0},function(){a.errorTextAlert="Error, Something gone wrong.",a.showErrorAlert=!0})},a.submitHivePasswordForm=function(){test=a,Service.updateHivePassword(d,a,function(b){a.successTextAlert="Setting has been updated successfully.",a.showSuccessAlert=!0},function(){a.errorTextAlert="Error, Something gone wrong.",a.showErrorAlert=!0})},a.switchBool=function(b){a[b]=!a[b]}}]),function(){"use strict";function a(a,c,d,e,f){function g(a,b,c){e(function(){var d;f.GetByUsername(a).then(function(a){d=null!==a&&a.password===b?{success:!0}:{success:!1,message:"Username or password is incorrect"},c(d)})},1e3)}function h(e,f){var g=b.encode(e+":"+f);d.globals={currentUser:{username:e,authdata:g}},a.defaults.headers.common.Authorization="Basic "+g,c.put("globals",d.globals)}function i(){d.globals={},c.remove("globals"),a.defaults.headers.common.Authorization="Basic "}var j={};return j.Login=g,j.SetCredentials=h,j.ClearCredentials=i,j}angular.module("app").factory("AuthenticationService",a),a.$inject=["$http","$cookieStore","$rootScope","$timeout","UserService"];var b={keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b,c,d,e,f,g="",h="",i="",j=0;do{b=a.charCodeAt(j++),c=a.charCodeAt(j++),h=a.charCodeAt(j++),d=b>>2,e=(3&b)<<4|c>>4,f=(15&c)<<2|h>>6,i=63&h,isNaN(c)?f=i=64:isNaN(h)&&(i=64),g=g+this.keyStr.charAt(d)+this.keyStr.charAt(e)+this.keyStr.charAt(f)+this.keyStr.charAt(i),b=c=h="",d=e=f=i=""}while(j<a.length);return g},decode:function(a){var b,c,d,e,f,g="",h="",i="",j=0;/[^A-Za-z0-9\+\/\=]/g.exec(a)&&window.alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{d=this.keyStr.indexOf(a.charAt(j++)),e=this.keyStr.indexOf(a.charAt(j++)),f=this.keyStr.indexOf(a.charAt(j++)),i=this.keyStr.indexOf(a.charAt(j++)),b=d<<2|e>>4,c=(15&e)<<4|f>>2,h=(3&f)<<6|i,g+=String.fromCharCode(b),64!=f&&(g+=String.fromCharCode(c)),64!=i&&(g+=String.fromCharCode(h)),b=c=h="",d=e=f=i=""}while(j<a.length);return g}}}(),function(){"use strict";function a(a){function b(){function b(){var b=a.flash;b&&(b.keepAfterLocationChange?b.keepAfterLocationChange=!1:delete a.flash)}a.$on("$locationChangeStart",function(){b()})}function c(b,c){a.flash={message:b,type:"success",keepAfterLocationChange:c}}function d(b,c){a.flash={message:b,type:"error",keepAfterLocationChange:c}}var e={};return e.Success=c,e.Error=d,b(),e}angular.module("app").factory("FlashService",a),a.$inject=["$rootScope"]}(),function(){"use strict";function a(a){function b(){return a.get("/api/users").then(g,h("Error getting all users"))}function c(b){return a.get("/api/users/"+b).then(g,h("Error getting user by id"))}function d(b){return a.get("/api/users/"+b).then(g,h("Error getting user by username"))}function e(b){return a.post("/api/users",b).then(g,h("Error creating user"))}function f(b){return a.put("/api/users/"+b.id,b).then(g,h("Error updating user"))}function g(a){return a}function h(a){return function(){return{success:!1,message:a}}}var i={};return i.GetAll=b,i.GetById=c,i.GetByUsername=d,i.Create=e,i.Update=f,i.Delete=Delete,i}angular.module("app").factory("UserService",a),a.$inject=["$http"]}(),function(){"use strict";function a(a,b,c){function d(){var a=c.defer();return a.resolve(j()),a.promise}function e(a){var d=c.defer(),e=b("filter")(j(),{id:a}),f=e.length?e[0]:null;return d.resolve(f),d.promise}function f(a){var d=c.defer(),e=b("filter")(j(),{username:a}),f=e.length?e[0]:null;return d.resolve(f),d.promise}function g(b){var d=c.defer();return a(function(){f(b.username).then(function(a){if(null!==a)d.resolve({success:!1,message:'Username "'+b.username+'" is already taken'});else{var c=j(),e=c[c.length-1]||{id:0};b.id=e.id+1,c.push(b),k(c),d.resolve({success:!0})}})},1e3),d.promise}function h(a){for(var b=c.defer(),d=j(),e=0;e<d.length;e++)if(d[e].id===a.id){d[e]=a;break}return k(d),b.resolve(),b.promise}function i(a){for(var b=c.defer(),d=j(),e=0;e<d.length;e++){if(d[e].id===a){d.splice(e,1);break}}return k(d),b.resolve(),b.promise}function j(){return localStorage.users||(localStorage.users=JSON.stringify([])),JSON.parse(localStorage.users)}function k(a){localStorage.users=JSON.stringify(a)}var l={};return l.GetAll=d,l.GetById=e,l.GetByUsername=f,l.Create=g,l.Update=h,l.Delete=i,l}angular.module("app").factory("UserService",a),a.$inject=["$timeout","$filter","$q"]}();